<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Digital Zen Garden - 高度モジュラーシステム</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Noto+Sans+JP:wght@300;400;500&display=swap');
        
        :root {
            /* ダークモード（宇宙）色設定 */
            --zen-black: #1a1a1a;
            --zen-charcoal: #2d2d2d;
            --zen-stone: #4a4a4a;
            --zen-silver: #8a8a8a;
            --zen-pearl: #e8e8e8;
            --zen-white: #fafafa;
            --zen-accent: #d4af37;
            --zen-danger: #d32f2f;
            --zen-success: #388e3c;
            
            /* テーマ変数 */
            --bg-primary: linear-gradient(135deg, var(--zen-black) 0%, var(--zen-charcoal) 100%);
            --text-primary: var(--zen-pearl);
            --text-secondary: var(--zen-silver);
            --particle-color: 0xd4af37;
            --scene-bg: 0x1a1a1a;
            
            --golden-ratio: 1.618;
            --breathing: cubic-bezier(0.4, 0.0, 0.2, 1);
            --meditation: cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }
        
        /* 和紙モード */
        [data-theme="washi"] {
            --zen-black: #2d2d2d;
            --zen-charcoal: #f8f8f0;
            --zen-stone: #e0e0d8;
            --zen-silver: #6d6d6d;
            --zen-pearl: #2d2d2d;
            --zen-white: #1a1a1a;
            --zen-accent: #8b4513;
            
            --bg-primary: linear-gradient(135deg, #f8f8f0 0%, #e8e8e0 100%);
            --text-primary: #2d2d2d;
            --text-secondary: #6d6d6d;
            --particle-color: 0x8b4513;
            --scene-bg: 0xf8f8f0;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', 'Noto Sans JP', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: calc(1em * var(--golden-ratio));
            overflow-x: hidden;
            min-height: 100vh;
            transition: all 2s var(--meditation);
        }

        /* ローディング画面 */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--zen-charcoal);
            z-index: 20000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            opacity: 1;
            transition: opacity 1s var(--meditation);
        }

        .loading-overlay.fade-out {
            opacity: 0;
            pointer-events: none;
        }

        .loading-text {
            font-size: 2rem;
            font-weight: 300;
            color: var(--text-primary);
            margin-bottom: 2rem;
            opacity: 0;
            animation: breatheInText 3s var(--meditation) 0.5s forwards;
            letter-spacing: 0.3em;
        }

        .loading-progress {
            width: 200px;
            height: 1px;
            background: rgba(212, 175, 55, 0.2);
            position: relative;
            overflow: hidden;
        }

        .loading-progress::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: var(--zen-accent);
            animation: loadingProgress 3s var(--meditation) forwards;
        }

        /* 開発者モード - 拡張版 */
        .dev-mode {
            position: fixed;
            top: 10px;
            left: 10px;
            z-index: 10000;
            background: rgba(26, 26, 26, 0.98);
            padding: 1.5rem;
            border-radius: 12px;
            border: 1px solid var(--zen-accent);
            max-width: 450px;
            max-height: 80vh;
            overflow-y: auto;
            display: none;
            backdrop-filter: blur(20px);
        }

        .dev-mode.active {
            display: block;
        }

        .dev-toggle {
            position: fixed;
            top: 10px;
            left: 10px;
            z-index: 10001;
            background: var(--zen-accent);
            color: var(--zen-black);
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.8rem;
            font-weight: 500;
            transition: all 0.3s var(--breathing);
        }

        .dev-toggle:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(212, 175, 55, 0.3);
        }

        .dev-tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            border-bottom: 1px solid var(--zen-stone);
            padding-bottom: 0.5rem;
        }

        .dev-tab {
            padding: 0.5rem 1rem;
            background: transparent;
            border: none;
            color: var(--zen-silver);
            cursor: pointer;
            border-radius: 4px;
            font-size: 0.8rem;
            transition: all 0.3s var(--breathing);
        }

        .dev-tab.active {
            background: var(--zen-accent);
            color: var(--zen-black);
        }

        .dev-panel {
            display: none;
        }

        .dev-panel.active {
            display: block;
        }

        .dev-form {
            display: flex;
            flex-direction: column;
            gap: 0.8rem;
        }

        .dev-form input, .dev-form textarea, .dev-form select {
            background: var(--zen-charcoal);
            border: 1px solid var(--zen-stone);
            color: var(--zen-pearl);
            padding: 0.6rem;
            border-radius: 6px;
            font-size: 0.8rem;
            transition: border-color 0.3s var(--breathing);
        }

        .dev-form input:focus, .dev-form textarea:focus, .dev-form select:focus {
            outline: none;
            border-color: var(--zen-accent);
        }

        .dev-form textarea {
            height: 150px;
            resize: vertical;
            font-family: 'Courier New', monospace;
            font-size: 0.75rem;
        }

        .dev-form button {
            background: var(--zen-accent);
            color: var(--zen-black);
            border: none;
            padding: 0.7rem;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s var(--breathing);
        }

        .dev-form button:hover {
            background: #c19b2a;
            transform: translateY(-1px);
        }

        .dev-form button.danger {
            background: var(--zen-danger);
            color: white;
        }

        .dev-form button.danger:hover {
            background: #b71c1c;
        }

        .artwork-list {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid var(--zen-stone);
            border-radius: 6px;
            background: var(--zen-charcoal);
        }

        .artwork-item {
            padding: 0.8rem;
            border-bottom: 1px solid var(--zen-stone);
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }

        .artwork-item:last-child {
            border-bottom: none;
        }

        .artwork-info h4 {
            color: var(--zen-accent);
            font-size: 0.9rem;
            margin-bottom: 0.2rem;
        }

        .artwork-info p {
            color: var(--zen-silver);
            font-size: 0.7rem;
            line-height: 1.4;
        }

        .artwork-controls {
            display: flex;
            gap: 0.5rem;
        }

        .btn-small {
            padding: 0.3rem 0.6rem;
            font-size: 0.7rem;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s var(--breathing);
        }

        .btn-edit {
            background: var(--zen-accent);
            color: var(--zen-black);
        }

        .btn-delete {
            background: var(--zen-danger);
            color: white;
        }

        .btn-small:hover {
            transform: translateY(-1px);
        }

        .type-indicator {
            display: inline-block;
            padding: 0.2rem 0.4rem;
            border-radius: 3px;
            font-size: 0.6rem;
            font-weight: 500;
            margin-left: 0.5rem;
        }

        .type-canvas {
            background: rgba(76, 175, 80, 0.2);
            color: #4caf50;
        }

        .type-threejs {
            background: rgba(33, 150, 243, 0.2);
            color: #2196f3;
        }

        /* Three.js Canvas Background */
        #zen-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            opacity: 0.7;
        }
        
        /* Navigation */
        nav {
            position: fixed;
            top: 2rem;
            right: 2rem;
            z-index: 1000;
            display: flex;
            gap: 2rem;
            align-items: center;
            padding: 1rem 2rem;
            background: rgba(26, 26, 26, 0.8);
            backdrop-filter: blur(20px);
            border-radius: 50px;
            border: 1px solid rgba(232, 232, 232, 0.1);
            transition: background 2s var(--meditation);
        }

        [data-theme="washi"] nav {
            background: rgba(248, 248, 240, 0.9);
            border-color: rgba(45, 45, 45, 0.1);
        }
        
        .nav-item {
            color: var(--text-secondary);
            text-decoration: none;
            font-weight: 300;
            font-size: 0.9rem;
            transition: all 0.3s var(--breathing);
            position: relative;
        }
        
        .nav-item:hover {
            color: var(--zen-accent);
            transform: translateY(-1px);
        }
        
        .nav-item::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 50%;
            width: 0;
            height: 1px;
            background: var(--zen-accent);
            transition: all 0.3s var(--meditation);
            transform: translateX(-50%);
        }
        
        .nav-item:hover::after {
            width: 100%;
        }

        /* テーマ切り替えボタン */
        .theme-toggle {
            background: none;
            border: 2px solid var(--zen-accent);
            color: var(--zen-accent);
            padding: 0.5rem 1rem;
            border-radius: 25px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.5s var(--meditation);
            position: relative;
            overflow: hidden;
        }

        .theme-toggle:hover {
            background: var(--zen-accent);
            color: var(--zen-black);
            transform: translateY(-2px);
        }

        .theme-toggle::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: var(--zen-accent);
            transition: all 0.5s var(--meditation);
            transform: translate(-50%, -50%);
            border-radius: 50%;
        }

        .theme-toggle:hover::before {
            width: 200%;
            height: 200%;
        }

        .theme-toggle span {
            position: relative;
            z-index: 1;
        }
        
        /* Hero Section */
        .hero {
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 2rem;
            position: relative;
        }
        
        .hero-title {
            font-size: clamp(3rem, 8vw, 6rem);
            font-weight: 300;
            margin-bottom: 1rem;
            opacity: 0;
            animation: breatheIn 2s var(--meditation) 0.5s forwards;
            letter-spacing: 0.05em;
        }
        
        .hero-subtitle {
            font-size: clamp(1rem, 3vw, 1.5rem);
            font-weight: 300;
            color: var(--text-secondary);
            opacity: 0;
            animation: breatheIn 2s var(--meditation) 1s forwards;
            margin-bottom: 2rem;
        }

        .hero-philosophy {
            font-size: clamp(1rem, 2.5vw, 1.3rem);
            font-weight: 300;
            color: var(--text-secondary);
            opacity: 0;
            animation: breatheIn 2s var(--meditation) 1.5s forwards;
            margin-bottom: 3rem;
            max-width: 600px;
            line-height: 1.8;
        }

        .hero-philosophy br {
            content: "";
            margin: 0.5rem 0;
            display: block;
        }
        
        .scroll-indicator {
            position: absolute;
            bottom: 3rem;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            animation: breatheIn 2s var(--meditation) 2s forwards;
        }
        
        .scroll-line {
            width: 1px;
            height: 3rem;
            background: linear-gradient(to bottom, transparent, var(--zen-accent), transparent);
            margin: 0 auto 1rem;
            animation: pulse 3s ease-in-out infinite;
        }
        
        /* Works Grid */
        .works-section {
            padding: 8rem 2rem;
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .section-title {
            font-size: clamp(2rem, 5vw, 3rem);
            font-weight: 300;
            text-align: center;
            margin-bottom: 4rem;
            opacity: 0;
            transform: translateY(2rem);
            transition: all 1s var(--meditation);
        }
        
        .section-title.visible {
            opacity: 1;
            transform: translateY(0);
        }
        
        .works-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 3rem;
            margin-bottom: 6rem;
        }
        
        .work-card {
            background: rgba(74, 74, 74, 0.1);
            border-radius: 1rem;
            padding: 2rem;
            border: 1px solid rgba(232, 232, 232, 0.05);
            backdrop-filter: blur(10px);
            transition: all 0.5s var(--breathing);
            opacity: 0;
            transform: translateY(3rem);
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        [data-theme="washi"] .work-card {
            background: rgba(45, 45, 45, 0.05);
            border-color: rgba(45, 45, 45, 0.1);
        }
        
        .work-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(212, 175, 55, 0.1), transparent);
            transition: left 0.8s var(--meditation);
        }
        
        .work-card:hover::before {
            left: 100%;
        }
        
        .work-card.visible {
            opacity: 1;
            transform: translateY(0);
        }
        
        .work-card:hover {
            transform: translateY(-0.5rem);
            border-color: rgba(212, 175, 55, 0.3);
            box-shadow: 0 20px 40px rgba(212, 175, 55, 0.1);
        }

        .work-card.threejs {
            border-color: rgba(33, 150, 243, 0.2);
        }

        .work-card.threejs:hover {
            border-color: rgba(33, 150, 243, 0.5);
            box-shadow: 0 20px 40px rgba(33, 150, 243, 0.1);
        }
        
        .work-preview {
            width: 100%;
            height: 200px;
            background: linear-gradient(135deg, var(--zen-charcoal), var(--zen-stone));
            border-radius: 0.5rem;
            margin-bottom: 1.5rem;
            position: relative;
            overflow: hidden;
        }
        
        .work-title {
            font-size: 1.3rem;
            font-weight: 500;
            margin-bottom: 0.8rem;
            color: var(--text-primary);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .title-text {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .work-controls {
            display: flex;
            gap: 0.5rem;
        }

        .copy-code-btn {
            background: rgba(212, 175, 55, 0.2);
            color: var(--zen-accent);
            border: 1px solid rgba(212, 175, 55, 0.4);
            padding: 0.3rem 0.8rem;
            border-radius: 0.5rem;
            font-size: 0.7rem;
            cursor: pointer;
            transition: all 0.3s var(--breathing);
        }

        .copy-code-btn:hover {
            background: rgba(212, 175, 55, 0.3);
            transform: translateY(-2px);
        }

        .copy-code-btn.copied {
            background: rgba(76, 175, 80, 0.3);
            color: #4caf50;
            border-color: rgba(76, 175, 80, 0.5);
        }

        .edit-btn, .delete-btn {
            padding: 0.3rem 0.8rem;
            border-radius: 0.5rem;
            font-size: 0.7rem;
            cursor: pointer;
            transition: all 0.3s var(--breathing);
            border: 1px solid;
        }

        .edit-btn {
            background: rgba(138, 138, 138, 0.2);
            color: var(--text-secondary);
            border-color: rgba(138, 138, 138, 0.4);
        }

        .edit-btn:hover {
            background: rgba(138, 138, 138, 0.3);
            transform: translateY(-2px);
        }

        .delete-btn {
            background: rgba(211, 47, 47, 0.2);
            color: var(--zen-danger);
            border-color: rgba(211, 47, 47, 0.4);
        }

        .delete-btn:hover {
            background: rgba(211, 47, 47, 0.3);
            transform: translateY(-2px);
        }
        
        .work-description {
            color: var(--text-secondary);
            font-size: 0.9rem;
            line-height: 1.6;
            margin-bottom: 1rem;
        }
        
        .work-tech {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }
        
        .tech-tag {
            background: rgba(212, 175, 55, 0.1);
            color: var(--zen-accent);
            padding: 0.3rem 0.8rem;
            border-radius: 1rem;
            font-size: 0.8rem;
            border: 1px solid rgba(212, 175, 55, 0.2);
        }

        /* About Section */
        .about-section {
            padding: 8rem 2rem;
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(248, 248, 240, 0.02);
            border-radius: 2rem;
            position: relative;
            overflow: hidden;
        }

        [data-theme="washi"] .about-section {
            background: rgba(45, 45, 45, 0.03);
        }

        .about-section::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle at center, rgba(212, 175, 55, 0.05) 0%, transparent 70%);
            animation: rotateGlow 30s linear infinite;
        }

        .about-content {
            position: relative;
            z-index: 1;
            text-align: center;
        }

        .about-title {
            font-size: clamp(2rem, 4vw, 2.5rem);
            font-weight: 300;
            margin-bottom: 3rem;
            color: var(--text-primary);
        }

        .about-philosophy {
            font-size: clamp(1rem, 2vw, 1.2rem);
            line-height: 2;
            color: var(--text-secondary);
            text-align: justify;
            max-width: 800px;
            margin: 0 auto;
        }

        .about-philosophy strong {
            color: var(--zen-accent);
            font-weight: 500;
        }

        /* Footer */
        .footer {
            padding: 4rem 2rem 2rem;
            text-align: center;
            border-top: 1px solid rgba(232, 232, 232, 0.1);
            margin-top: 4rem;
        }

        [data-theme="washi"] .footer {
            border-color: rgba(45, 45, 45, 0.1);
        }

        .footer-quote {
            font-size: 1rem;
            color: var(--text-secondary);
            margin-bottom: 2rem;
            font-style: italic;
        }

        .footer-signature {
            font-size: 0.8rem;
            color: var(--text-secondary);
            opacity: 0.7;
        }

        .footer-signature .signature-name {
            font-style: italic;
            color: var(--zen-accent);
        }

        /* Work Modal */
        .work-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(20px);
            z-index: 10000;
            display: flex;
            flex-direction: column;
            opacity: 0;
            pointer-events: none;
            transition: all 0.5s var(--meditation);
        }

        [data-theme="washi"] .work-modal {
            background: rgba(248, 248, 240, 0.95);
        }
        
        .work-modal.active {
            opacity: 1;
            pointer-events: all;
        }
        
        .modal-header {
            padding: 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(232, 232, 232, 0.1);
        }

        [data-theme="washi"] .modal-header {
            border-color: rgba(45, 45, 45, 0.1);
        }
        
        .modal-title {
            color: var(--text-primary);
            font-size: 1.5rem;
            font-weight: 300;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .close-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 2rem;
            cursor: pointer;
            padding: 0.5rem;
            transition: all 0.3s var(--breathing);
            border-radius: 50%;
            width: 3rem;
            height: 3rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .close-btn:hover {
            color: var(--zen-accent);
            background: rgba(212, 175, 55, 0.1);
            transform: rotate(90deg);
        }
        
        .modal-content {
            flex: 1;
            position: relative;
            overflow: hidden;
        }
        
        .work-canvas {
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at center, var(--zen-charcoal) 0%, var(--zen-black) 100%);
        }

        [data-theme="washi"] .work-canvas {
            background: radial-gradient(circle at center, #f8f8f0 0%, #e8e8e0 100%);
        }
        
        /* Animations */
        @keyframes breatheIn {
            from {
                opacity: 0;
                transform: translateY(2rem);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes breatheInText {
            from {
                opacity: 0;
                transform: translateY(1rem);
                letter-spacing: 0.1em;
            }
            to {
                opacity: 1;
                transform: translateY(0);
                letter-spacing: 0.3em;
            }
        }

        @keyframes loadingProgress {
            from {
                left: -100%;
            }
            to {
                left: 100%;
            }
        }

        @keyframes rotateGlow {
            from {
                transform: rotate(0deg);
            }
            to {
                transform: rotate(360deg);
            }
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            nav {
                top: 1rem;
                right: 1rem;
                left: 1rem;
                justify-content: center;
                gap: 1rem;
                padding: 0.8rem 1rem;
                flex-wrap: wrap;
            }
            
            .works-grid {
                grid-template-columns: 1fr;
                gap: 2rem;
            }
            
            .work-card {
                padding: 1.5rem;
            }

            .dev-toggle {
                font-size: 0.7rem;
                padding: 0.4rem 0.8rem;
            }

            .dev-mode {
                max-width: calc(100vw - 20px);
                padding: 1rem;
            }

            .work-title {
                flex-direction: column;
                align-items: flex-start;
            }

            .work-controls {
                flex-wrap: wrap;
            }

            .hero-philosophy {
                font-size: 1rem;
                line-height: 1.6;
            }

            .about-section {
                padding: 4rem 2rem;
            }

            .theme-toggle {
                font-size: 0.8rem;
                padding: 0.4rem 0.8rem;
            }
        }
        
        /* Smooth scrolling */
        html {
            scroll-behavior: smooth;
        }
    </style>
</head>
<body>
    <!-- ローディング画面 -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-text">still... becoming...</div>
        <div class="loading-progress"></div>
    </div>

    <!-- 開発者モードボタン -->
    <button class="dev-toggle" onclick="toggleDevMode()">🛠 開発</button>
    
    <!-- 開発者モード - 拡張版 -->
    <div class="dev-mode" id="devMode">
        <div class="dev-tabs">
            <button class="dev-tab active" onclick="switchDevTab('add')">➕ 追加</button>
            <button class="dev-tab" onclick="switchDevTab('manage')">📋 管理</button>
            <button class="dev-tab" onclick="switchDevTab('help')">❓ ヘルプ</button>
        </div>

        <!-- 追加パネル -->
        <div class="dev-panel active" id="addPanel">
            <h3 style="color: var(--zen-accent); margin-bottom: 1rem; font-size: 1rem;">新作品追加</h3>
            <form class="dev-form" onsubmit="addNewWork(event)">
                <input type="text" id="newTitle" placeholder="作品タイトル" required>
                <textarea id="newDescription" placeholder="作品説明" required></textarea>
                <input type="text" id="newTech" placeholder="技術タグ (カンマ区切り)" required>
                
                <select id="newType" onchange="updateCodeTemplate()" required>
                    <option value="">作品タイプを選択</option>
                    <option value="canvas">Canvas 2D アニメーション</option>
                    <option value="threejs">Three.js 3D作品</option>
                </select>
                
                <textarea id="newCode" placeholder="コードを記述..." required></textarea>
                <button type="submit">作品を追加</button>
            </form>
        </div>

        <!-- 管理パネル -->
        <div class="dev-panel" id="managePanel">
            <h3 style="color: var(--zen-accent); margin-bottom: 1rem; font-size: 1rem;">作品管理</h3>
            <div class="artwork-list" id="artworkList">
                <!-- 動的生成 -->
            </div>
        </div>

        <!-- ヘルプパネル -->
        <div class="dev-panel" id="helpPanel">
            <h3 style="color: var(--zen-accent); margin-bottom: 1rem; font-size: 1rem;">使い方ガイド</h3>
            <div style="font-size: 0.8rem; line-height: 1.6; color: var(--zen-silver);">
                <h4 style="color: var(--zen-accent); margin: 1rem 0 0.5rem;">Canvas 2D 作品:</h4>
                <code style="background: var(--zen-charcoal); padding: 0.2rem; border-radius: 3px;">
                function draw(ctx, canvas) {<br>
                &nbsp;&nbsp;// 描画コード<br>
                &nbsp;&nbsp;ctx.fillStyle = '#000';<br>
                &nbsp;&nbsp;ctx.fillRect(0, 0, canvas.width, canvas.height);<br>
                }
                </code>
                
                <h4 style="color: var(--zen-accent); margin: 1rem 0 0.5rem;">Three.js 3D 作品:</h4>
                <code style="background: var(--zen-charcoal); padding: 0.2rem; border-radius: 3px;">
                function initThreeJS(container) {<br>
                &nbsp;&nbsp;// Three.jsシーン初期化<br>
                &nbsp;&nbsp;const scene = new THREE.Scene();<br>
                &nbsp;&nbsp;// ... 3D設定<br>
                &nbsp;&nbsp;return { scene, camera, renderer, animate };<br>
                }
                </code>

                <h4 style="color: var(--zen-accent); margin: 1rem 0 0.5rem;">操作:</h4>
                • <strong>コピー</strong>: 📋ボタンでコード取得<br>
                • <strong>編集</strong>: ✏️ボタンで修正<br>
                • <strong>削除</strong>: 🗑️ボタンで削除<br>
                • <strong>プレビュー</strong>: カードクリックで表示
            </div>
        </div>
    </div>

    <canvas id="zen-canvas"></canvas>
    
    <nav>
        <a href="#works" class="nav-item">作品</a>
        <a href="#about" class="nav-item">概要</a>
        <a href="#contact" class="nav-item">連絡</a>
        <button class="theme-toggle" onclick="toggleTheme()">
            <span id="themeIcon">🌌 ⇄ 🌸</span>
        </button>
    </nav>
    
    <section class="hero">
        <h1 class="hero-title">Digital Zen Garden</h1>
        <p class="hero-subtitle">高度モジュラー技術実験ラボラトリー</p>
        <p class="hero-philosophy">
            この庭はまだ完成していない。<br>
            それでも、美しい。
        </p>
        <div class="scroll-indicator">
            <div class="scroll-line"></div>
            <span style="font-size: 0.8rem; color: var(--text-secondary);">scroll</span>
        </div>
    </section>
    
    <section id="works" class="works-section">
        <h2 class="section-title">技術見本・実験ギャラリー</h2>
        <div class="works-grid" id="worksGrid">
            <!-- 作品は動的生成 -->
        </div>
    </section>

    <!-- About Section -->
    <section id="about" class="about-section">
        <div class="about-content">
            <h2 class="about-title">構造、瞑想、未完成</h2>
            <p class="about-philosophy">
                <strong>ZEN GARDEN</strong> は、「変化しながら在ること」の可視化装置です。<br>
                技術によって静けさを描き、構造によって自分自身を映す。<br>
                この庭は、今も静かに生成されています。
            </p>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer" id="contact">
        <p class="footer-quote">A digital garden that is always becoming.</p>
        <p class="footer-signature">
            Created by <span class="signature-name">Tatsuya Minegishi</span>
        </p>
    </footer>
    
    <!-- Work Modal -->
    <div id="workModal" class="work-modal">
        <div class="modal-header">
            <h3 class="modal-title" id="modalTitle">作品タイトル</h3>
            <button class="close-btn" onclick="closeWorkModal()">×</button>
        </div>
        <div class="modal-content">
            <canvas class="work-canvas" id="workCanvas"></canvas>
        </div>
    </div>

    <script>
        // グローバル変数
        let currentTheme = 'cosmos';
        let backgroundInstance = null;

        // 作品データベース（Canvas 2D + Three.js 対応）
        let artworks = [
            {
                id: 'zen-mandala',
                title: '禅曼荼羅',
                description: '呼吸に合わせて回転する曼荼羅。墨絵の美学をデジタルで表現。',
                tech: ['Canvas 2D', '数学', '禅美学'],
                category: 'zen',
                type: 'canvas',
                codeString: `function draw(ctx, canvas) {
    const centerX = canvas.width / 2;
    const centerY = canvas.height / 2;
    const time = Date.now() * 0.001;
    
    // テーマに応じた背景
    const isWashi = document.documentElement.dataset.theme === 'washi';
    ctx.fillStyle = isWashi ? '#f8f8f0' : '#1a1a1a';
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    
    // 曼荼羅の層を描画
    const layers = 8;
    for (let layer = 0; layer < layers; layer++) {
        const radius = (layer + 1) * 25;
        const rotation = time * (layer % 2 === 0 ? 0.3 : -0.3);
        
        ctx.save();
        ctx.translate(centerX, centerY);
        ctx.rotate(rotation);
        
        // 円環描画
        ctx.beginPath();
        ctx.arc(0, 0, radius, 0, Math.PI * 2);
        ctx.strokeStyle = isWashi ? \`rgba(45, 45, 45, \${0.3 + layer * 0.1})\` : \`rgba(232, 232, 232, \${0.3 + layer * 0.1})\`;
        ctx.lineWidth = 2;
        ctx.stroke();
        
        ctx.restore();
    }
    
    // 中心の金色の点
    ctx.beginPath();
    ctx.arc(centerX, centerY, 5, 0, Math.PI * 2);
    ctx.fillStyle = isWashi ? 'rgba(139, 69, 19, 0.9)' : 'rgba(212, 175, 55, 0.9)';
    ctx.fill();
}`,
                drawFunction: function(ctx, canvas) {
                    const centerX = canvas.width / 2;
                    const centerY = canvas.height / 2;
                    const time = Date.now() * 0.001;
                    
                    const isWashi = document.documentElement.dataset.theme === 'washi';
                    ctx.fillStyle = isWashi ? '#f8f8f0' : '#1a1a1a';
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                    
                    const layers = 8;
                    for (let layer = 0; layer < layers; layer++) {
                        const radius = (layer + 1) * 25;
                        const rotation = time * (layer % 2 === 0 ? 0.3 : -0.3);
                        
                        ctx.save();
                        ctx.translate(centerX, centerY);
                        ctx.rotate(rotation);
                        
                        ctx.beginPath();
                        ctx.arc(0, 0, radius, 0, Math.PI * 2);
                        ctx.strokeStyle = isWashi ? `rgba(45, 45, 45, ${0.3 + layer * 0.1})` : `rgba(232, 232, 232, ${0.3 + layer * 0.1})`;
                        ctx.lineWidth = 2;
                        ctx.stroke();
                        
                        ctx.restore();
                    }
                    
                    ctx.beginPath();
                    ctx.arc(centerX, centerY, 5, 0, Math.PI * 2);
                    ctx.fillStyle = isWashi ? 'rgba(139, 69, 19, 0.9)' : 'rgba(212, 175, 55, 0.9)';
                    ctx.fill();
                }
            },
            {
                id: 'ultimate-mandala-3d',
                title: '究極禅曼荼羅 3D',
                description: '究極の3D禅曼荼羅。六段階の禅的進化を3Dで表現する神聖幾何学システム。',
                tech: ['Three.js', 'WebGL', 'GLSL', '禅哲学'],
                category: 'ultimate',
                type: 'threejs',
                codeString: `function initThreeJS(container) {
    // シーン初期化
    const scene = new THREE.Scene();
    const isWashi = document.documentElement.dataset.theme === 'washi';
    scene.background = new THREE.Color(isWashi ? 0xf8f8f0 : 0x1a1a1a);
    
    // カメラ
    const camera = new THREE.PerspectiveCamera(60, container.offsetWidth / container.offsetHeight, 0.1, 1000);
    camera.position.set(0, 15, 40);
    
    // レンダラー
    const renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(container.offsetWidth, container.offsetHeight);
    renderer.setPixelRatio(window.devicePixelRatio);
    container.appendChild(renderer.domElement);
    
    // 究極のシェーダー
    const ultimateVertexShader = \`
        varying vec2 vUv;
        varying vec3 vNormal;
        uniform float time;
        
        void main() {
            vUv = uv;
            vNormal = normalize(normalMatrix * normal);
            
            vec3 pos = position;
            float breath = sin(time * 0.5) * 0.1;
            pos *= 1.0 + breath;
            
            gl_Position = projectionMatrix * modelViewMatrix * vec4(pos, 1.0);
        }
    \`;
    
    const ultimateFragmentShader = \`
        uniform float time;
        uniform vec3 color1;
        uniform vec3 color2;
        varying vec2 vUv;
        varying vec3 vNormal;
        
        void main() {
            float fresnel = 1.0 - abs(dot(vNormal, vec3(0.0, 0.0, 1.0)));
            vec3 color = mix(color1, color2, fresnel);
            gl_FragColor = vec4(color, 0.8);
        }
    \`;
    
    // 神聖幾何学メッシュ
    const geometry = new THREE.IcosahedronGeometry(10, 2);
    const material = new THREE.ShaderMaterial({
        vertexShader: ultimateVertexShader,
        fragmentShader: ultimateFragmentShader,
        uniforms: {
            time: { value: 0 },
            color1: { value: new THREE.Color(isWashi ? 0x2d2d2d : 0x000000) },
            color2: { value: new THREE.Color(isWashi ? 0x8b4513 : 0xd4af37) }
        },
        transparent: true,
        wireframe: true
    });
    
    const mesh = new THREE.Mesh(geometry, material);
    scene.add(mesh);
    
    // パーティクルシステム
    const particleGeometry = new THREE.BufferGeometry();
    const particleCount = 1000;
    const positions = new Float32Array(particleCount * 3);
    
    for (let i = 0; i < particleCount; i++) {
        const theta = Math.random() * Math.PI * 2;
        const phi = Math.acos(Math.random() * 2 - 1);
        const radius = 15 + Math.random() * 10;
        
        positions[i * 3] = radius * Math.sin(phi) * Math.cos(theta);
        positions[i * 3 + 1] = radius * Math.sin(phi) * Math.sin(theta);
        positions[i * 3 + 2] = radius * Math.cos(phi);
    }
    
    particleGeometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
    
    const particleMaterial = new THREE.PointsMaterial({
        size: 1.5,
        color: isWashi ? 0x8b4513 : 0xd4af37,
        transparent: true,
        opacity: 0.6,
        blending: THREE.AdditiveBlending
    });
    
    const particles = new THREE.Points(particleGeometry, particleMaterial);
    scene.add(particles);
    
    // ライティング
    const ambientLight = new THREE.AmbientLight(0xffffff, 0.4);
    scene.add(ambientLight);
    
    const pointLight = new THREE.PointLight(isWashi ? 0x8b4513 : 0xd4af37, 0.8);
    pointLight.position.set(0, 20, 0);
    scene.add(pointLight);
    
    // アニメーション関数
    function animate() {
        const time = Date.now() * 0.001;
        
        // メッシュアニメーション
        mesh.rotation.y += 0.005;
        mesh.rotation.x += 0.002;
        material.uniforms.time.value = time;
        
        // パーティクルアニメーション
        particles.rotation.y -= 0.001;
        
        // ライトアニメーション
        pointLight.position.x = Math.cos(time * 0.5) * 20;
        pointLight.position.z = Math.sin(time * 0.5) * 20;
        
        renderer.render(scene, camera);
    }
    
    return { scene, camera, renderer, animate };
}`,
                initFunction: function(container) {
                    const scene = new THREE.Scene();
                    const isWashi = document.documentElement.dataset.theme === 'washi';
                    scene.background = new THREE.Color(isWashi ? 0xf8f8f0 : 0x1a1a1a);
                    
                    const camera = new THREE.PerspectiveCamera(60, container.offsetWidth / container.offsetHeight, 0.1, 1000);
                    camera.position.set(0, 15, 40);
                    
                    const renderer = new THREE.WebGLRenderer({ antialias: true });
                    renderer.setSize(container.offsetWidth, container.offsetHeight);
                    renderer.setPixelRatio(window.devicePixelRatio);
                    container.appendChild(renderer.domElement);
                    
                    const ultimateVertexShader = `
                        varying vec2 vUv;
                        varying vec3 vNormal;
                        uniform float time;
                        
                        void main() {
                            vUv = uv;
                            vNormal = normalize(normalMatrix * normal);
                            
                            vec3 pos = position;
                            float breath = sin(time * 0.5) * 0.1;
                            pos *= 1.0 + breath;
                            
                            gl_Position = projectionMatrix * modelViewMatrix * vec4(pos, 1.0);
                        }
                    `;
                    
                    const ultimateFragmentShader = `
                        uniform float time;
                        uniform vec3 color1;
                        uniform vec3 color2;
                        varying vec2 vUv;
                        varying vec3 vNormal;
                        
                        void main() {
                            float fresnel = 1.0 - abs(dot(vNormal, vec3(0.0, 0.0, 1.0)));
                            vec3 color = mix(color1, color2, fresnel);
                            gl_FragColor = vec4(color, 0.8);
                        }
                    `;
                    
                    const geometry = new THREE.IcosahedronGeometry(10, 2);
                    const material = new THREE.ShaderMaterial({
                        vertexShader: ultimateVertexShader,
                        fragmentShader: ultimateFragmentShader,
                        uniforms: {
                            time: { value: 0 },
                            color1: { value: new THREE.Color(isWashi ? 0x2d2d2d : 0x000000) },
                            color2: { value: new THREE.Color(isWashi ? 0x8b4513 : 0xd4af37) }
                        },
                        transparent: true,
                        wireframe: true
                    });
                    
                    const mesh = new THREE.Mesh(geometry, material);
                    scene.add(mesh);
                    
                    const particleGeometry = new THREE.BufferGeometry();
                    const particleCount = 1000;
                    const positions = new Float32Array(particleCount * 3);
                    
                    for (let i = 0; i < particleCount; i++) {
                        const theta = Math.random() * Math.PI * 2;
                        const phi = Math.acos(Math.random() * 2 - 1);
                        const radius = 15 + Math.random() * 10;
                        
                        positions[i * 3] = radius * Math.sin(phi) * Math.cos(theta);
                        positions[i * 3 + 1] = radius * Math.sin(phi) * Math.sin(theta);
                        positions[i * 3 + 2] = radius * Math.cos(phi);
                    }
                    
                    particleGeometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));
                    
                    const particleMaterial = new THREE.PointsMaterial({
                        size: 1.5,
                        color: isWashi ? 0x8b4513 : 0xd4af37,
                        transparent: true,
                        opacity: 0.6,
                        blending: THREE.AdditiveBlending
                    });
                    
                    const particles = new THREE.Points(particleGeometry, particleMaterial);
                    scene.add(particles);
                    
                    const ambientLight = new THREE.AmbientLight(0xffffff, 0.4);
                    scene.add(ambientLight);
                    
                    const pointLight = new THREE.PointLight(isWashi ? 0x8b4513 : 0xd4af37, 0.8);
                    pointLight.position.set(0, 20, 0);
                    scene.add(pointLight);
                    
                    function animate() {
                        const time = Date.now() * 0.001;
                        
                        mesh.rotation.y += 0.005;
                        mesh.rotation.x += 0.002;
                        material.uniforms.time.value = time;
                        
                        particles.rotation.y -= 0.001;
                        
                        pointLight.position.x = Math.cos(time * 0.5) * 20;
                        pointLight.position.z = Math.sin(time * 0.5) * 20;
                        
                        renderer.render(scene, camera);
                    }
                    
                    return { scene, camera, renderer, animate };
                }
            },
            {
                id: 'breathing-circle',
                title: '呼吸する円',
                description: '瞑想のリズムに合わせて拡縮する禅的インターフェース。',
                tech: ['Canvas 2D', '瞑想', 'UI/UX'],
                category: 'meditation',
                type: 'canvas',
                codeString: `function draw(ctx, canvas) {
    const centerX = canvas.width / 2;
    const centerY = canvas.height / 2;
    const time = Date.now() * 0.001;
    
    // テーマに応じた背景
    const isWashi = document.documentElement.dataset.theme === 'washi';
    ctx.fillStyle = isWashi ? '#f8f8f0' : '#1a1a1a';
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    
    // 呼吸パターン（4秒吸う、4秒止める、4秒吐く）
    const cycle = time % 12;
    let breathe = 1;
    if (cycle < 4) {
        breathe = 1 + (cycle / 4) * 0.5; // 吸う
    } else if (cycle < 8) {
        breathe = 1.5; // 止める
    } else {
        breathe = 1.5 - ((cycle - 8) / 4) * 0.5; // 吐く
    }
    
    // 呼吸する円
    for (let i = 0; i < 5; i++) {
        const radius = (i + 1) * 30 * breathe;
        const alpha = (1 - i * 0.15) * 0.6;
        
        ctx.beginPath();
        ctx.arc(centerX, centerY, radius, 0, Math.PI * 2);
        ctx.strokeStyle = isWashi ? \`rgba(45, 45, 45, \${alpha})\` : \`rgba(232, 232, 232, \${alpha})\`;
        ctx.lineWidth = 2;
        ctx.stroke();
    }
    
    // 中心の核
    ctx.beginPath();
    ctx.arc(centerX, centerY, 10 * breathe, 0, Math.PI * 2);
    ctx.fillStyle = isWashi ? \`rgba(139, 69, 19, \${breathe - 0.5})\` : \`rgba(212, 175, 55, \${breathe - 0.5})\`;
    ctx.fill();
}`,
                drawFunction: function(ctx, canvas) {
                    const centerX = canvas.width / 2;
                    const centerY = canvas.height / 2;
                    const time = Date.now() * 0.001;
                    
                    const isWashi = document.documentElement.dataset.theme === 'washi';
                    ctx.fillStyle = isWashi ? '#f8f8f0' : '#1a1a1a';
                    ctx.fillRect(0, 0, canvas.width, canvas.height);
                    
                    const cycle = time % 12;
                    let breathe = 1;
                    if (cycle < 4) {
                        breathe = 1 + (cycle / 4) * 0.5;
                    } else if (cycle < 8) {
                        breathe = 1.5;
                    } else {
                        breathe = 1.5 - ((cycle - 8) / 4) * 0.5;
                    }
                    
                    for (let i = 0; i < 5; i++) {
                        const radius = (i + 1) * 30 * breathe;
                        const alpha = (1 - i * 0.15) * 0.6;
                        
                        ctx.beginPath();
                        ctx.arc(centerX, centerY, radius, 0, Math.PI * 2);
                        ctx.strokeStyle = isWashi ? `rgba(45, 45, 45, ${alpha})` : `rgba(232, 232, 232, ${alpha})`;
                        ctx.lineWidth = 2;
                        ctx.stroke();
                    }
                    
                    ctx.beginPath();
                    ctx.arc(centerX, centerY, 10 * breathe, 0, Math.PI * 2);
                    ctx.fillStyle = isWashi ? `rgba(139, 69, 19, ${breathe - 0.5})` : `rgba(212, 175, 55, ${breathe - 0.5})`;
                    ctx.fill();
                }
            }
        ];

        // グローバル変数
        let currentArtwork = null;
        let animationId = null;
        let threeJSInstance = null;
        let editingArtworkId = null;

        // テーマ切り替え
        function toggleTheme() {
            const html = document.documentElement;
            const themeIcon = document.getElementById('themeIcon');
            
            if (currentTheme === 'cosmos') {
                html.dataset.theme = 'washi';
                currentTheme = 'washi';
                themeIcon.textContent = '🌸 ⇄ 🌌';
            } else {
                html.removeAttribute('data-theme');
                currentTheme = 'cosmos';
                themeIcon.textContent = '🌌 ⇄ 🌸';
            }
            
            // 背景を再初期化
            if (backgroundInstance) {
                backgroundInstance.updateTheme();
            }
        }

        // ローディング画面
        function hideLoading() {
            setTimeout(() => {
                document.getElementById('loadingOverlay').classList.add('fade-out');
                setTimeout(() => {
                    document.getElementById('loadingOverlay').style.display = 'none';
                }, 1000);
            }, 3000);
        }

        // 開発者モードタブ切り替え
        function switchDevTab(tab) {
            document.querySelectorAll('.dev-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.dev-panel').forEach(p => p.classList.remove('active'));
            
            document.querySelector(`[onclick="switchDevTab('${tab}')"]`).classList.add('active');
            document.getElementById(tab + 'Panel').classList.add('active');
            
            if (tab === 'manage') {
                updateArtworkList();
            }
        }

        // コードテンプレート更新
        function updateCodeTemplate() {
            const type = document.getElementById('newType').value;
            const codeArea = document.getElementById('newCode');
            
            if (type === 'canvas') {
                codeArea.value = `function draw(ctx, canvas) {
    const centerX = canvas.width / 2;
    const centerY = canvas.height / 2;
    const time = Date.now() * 0.001;
    
    // テーマに応じた背景
    const isWashi = document.documentElement.dataset.theme === 'washi';
    ctx.fillStyle = isWashi ? '#f8f8f0' : '#1a1a1a';
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    
    // ここにアニメーションコードを記述
    ctx.beginPath();
    ctx.arc(centerX, centerY, 50 + Math.sin(time) * 20, 0, Math.PI * 2);
    ctx.strokeStyle = isWashi ? 'rgba(45, 45, 45, 0.8)' : 'rgba(232, 232, 232, 0.8)';
    ctx.lineWidth = 2;
    ctx.stroke();
}`;
            } else if (type === 'threejs') {
                codeArea.value = `function initThreeJS(container) {
    // シーン初期化
    const scene = new THREE.Scene();
    const isWashi = document.documentElement.dataset.theme === 'washi';
    scene.background = new THREE.Color(isWashi ? 0xf8f8f0 : 0x1a1a1a);
    
    // カメラ
    const camera = new THREE.PerspectiveCamera(75, container.offsetWidth / container.offsetHeight, 0.1, 1000);
    camera.position.z = 5;
    
    // レンダラー
    const renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(container.offsetWidth, container.offsetHeight);
    container.appendChild(renderer.domElement);
    
    // ジオメトリとマテリアル
    const geometry = new THREE.BoxGeometry();
    const material = new THREE.MeshBasicMaterial({ 
        color: isWashi ? 0x8b4513 : 0xd4af37, 
        wireframe: true 
    });
    const cube = new THREE.Mesh(geometry, material);
    scene.add(cube);
    
    // アニメーション関数
    function animate() {
        cube.rotation.x += 0.01;
        cube.rotation.y += 0.01;
        renderer.render(scene, camera);
    }
    
    return { scene, camera, renderer, animate };
}`;
            }
        }

        // 作品リスト更新
        function updateArtworkList() {
            const listContainer = document.getElementById('artworkList');
            listContainer.innerHTML = '';
            
            artworks.forEach(artwork => {
                const item = document.createElement('div');
                item.className = 'artwork-item';
                item.innerHTML = `
                    <div class="artwork-info">
                        <h4>${artwork.title}
                            <span class="type-indicator type-${artwork.type}">${artwork.type.toUpperCase()}</span>
                        </h4>
                        <p>${artwork.description}</p>
                    </div>
                    <div class="artwork-controls">
                        <button class="btn-small btn-edit" onclick="editArtwork('${artwork.id}')">✏️</button>
                        <button class="btn-small btn-delete" onclick="deleteArtwork('${artwork.id}')">🗑️</button>
                    </div>
                `;
                listContainer.appendChild(item);
            });
        }

        // 作品編集
        function editArtwork(artworkId) {
            const artwork = artworks.find(a => a.id === artworkId);
            if (!artwork) return;
            
            editingArtworkId = artworkId;
            
            document.getElementById('newTitle').value = artwork.title;
            document.getElementById('newDescription').value = artwork.description;
            document.getElementById('newTech').value = artwork.tech.join(', ');
            document.getElementById('newType').value = artwork.type;
            document.getElementById('newCode').value = artwork.codeString;
            
            switchDevTab('add');
            
            const submitBtn = document.querySelector('#addPanel button[type="submit"]');
            submitBtn.textContent = '変更を保存';
            submitBtn.style.background = 'var(--zen-success)';
        }

        // 作品削除
        function deleteArtwork(artworkId) {
            if (!confirm('この作品を削除しますか？この操作は取り消せません。')) return;
            
            const index = artworks.findIndex(a => a.id === artworkId);
            if (index !== -1) {
                artworks.splice(index, 1);
                generateWorkCards();
                updateArtworkList();
                alert('作品を削除しました。');
            }
        }

        // 作品カード動的生成
        function generateWorkCards() {
            const grid = document.getElementById('worksGrid');
            grid.innerHTML = '';

            artworks.forEach((artwork, index) => {
                const card = document.createElement('div');
                card.className = `work-card ${artwork.type}`;
                card.innerHTML = `
                    <div class="work-preview" id="preview-${artwork.id}"></div>
                    <div class="work-title">
                        <div class="title-text">
                            ${artwork.title}
                            <span class="type-indicator type-${artwork.type}">${artwork.type.toUpperCase()}</span>
                        </div>
                        <div class="work-controls">
                            <button class="copy-code-btn" onclick="copyCode('${artwork.id}')" title="コードをコピー">
                                📋
                            </button>
                            <button class="edit-btn" onclick="editArtwork('${artwork.id}')" title="編集">
                                ✏️
                            </button>
                            <button class="delete-btn" onclick="deleteArtwork('${artwork.id}')" title="削除">
                                🗑️
                            </button>
                        </div>
                    </div>
                    <p class="work-description">${artwork.description}</p>
                    <div class="work-tech">
                        ${artwork.tech.map(tech => `<span class="tech-tag">${tech}</span>`).join('')}
                    </div>
                `;

                card.addEventListener('click', (e) => {
                    if (!e.target.closest('button')) {
                        openWorkModal(index);
                    }
                });

                grid.appendChild(card);

                setTimeout(() => {
                    generatePreview(artwork);
                    card.classList.add('visible');
                }, index * 100);
            });
        }

        // プレビュー生成（Canvas 2D & Three.js 対応）
        function generatePreview(artwork) {
            const previewDiv = document.getElementById(`preview-${artwork.id}`);
            
            if (artwork.type === 'canvas') {
                const canvas = document.createElement('canvas');
                canvas.width = previewDiv.offsetWidth;
                canvas.height = previewDiv.offsetHeight;
                canvas.style.width = '100%';
                canvas.style.height = '100%';
                previewDiv.appendChild(canvas);

                const ctx = canvas.getContext('2d');
                
                function animate() {
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    artwork.drawFunction(ctx, canvas);
                    requestAnimationFrame(animate);
                }
                animate();
            } else if (artwork.type === 'threejs' && artwork.initFunction) {
                try {
                    const instance = artwork.initFunction(previewDiv);
                    if (instance && instance.animate) {
                        function animateLoop() {
                            instance.animate();
                            requestAnimationFrame(animateLoop);
                        }
                        animateLoop();
                    }
                } catch (error) {
                    console.error('Three.js preview error:', error);
                    previewDiv.innerHTML = '<div style="color: #d32f2f; padding: 1rem; text-align: center;">3D Preview Error</div>';
                }
            }
        }

        // モーダル開く（Canvas 2D & Three.js 対応）
        function openWorkModal(index) {
            currentArtwork = artworks[index];
            const modal = document.getElementById('workModal');
            const title = document.getElementById('modalTitle');
            const canvas = document.getElementById('workCanvas');

            title.innerHTML = `${currentArtwork.title} <span class="type-indicator type-${currentArtwork.type}">${currentArtwork.type.toUpperCase()}</span>`;
            modal.classList.add('active');
            document.body.style.overflow = 'hidden';

            if (threeJSInstance && threeJSInstance.renderer) {
                threeJSInstance.renderer.dispose();
                threeJSInstance = null;
            }

            setTimeout(() => {
                const rect = canvas.getBoundingClientRect();
                
                if (currentArtwork.type === 'canvas') {
                    canvas.width = rect.width;
                    canvas.height = rect.height;
                    const ctx = canvas.getContext('2d');
                    
                    function animate() {
                        if (!currentArtwork || currentArtwork.type !== 'canvas') return;
                        ctx.clearRect(0, 0, canvas.width, canvas.height);
                        currentArtwork.drawFunction(ctx, canvas);
                        animationId = requestAnimationFrame(animate);
                    }
                    animate();
                } else if (currentArtwork.type === 'threejs' && currentArtwork.initFunction) {
                    try {
                        canvas.style.display = 'none';
                        const container = canvas.parentElement;
                        
                        threeJSInstance = currentArtwork.initFunction(container);
                        
                        if (threeJSInstance && threeJSInstance.animate) {
                            function animate() {
                                if (!currentArtwork || currentArtwork.type !== 'threejs') return;
                                threeJSInstance.animate();
                                animationId = requestAnimationFrame(animate);
                            }
                            animate();
                        }
                    } catch (error) {
                        console.error('Three.js modal error:', error);
                        canvas.style.display = 'block';
                        const ctx = canvas.getContext('2d');
                        ctx.fillStyle = '#d32f2f';
                        ctx.font = '20px Arial';
                        ctx.textAlign = 'center';
                        ctx.fillText('Three.js Error', rect.width / 2, rect.height / 2);
                    }
                }
            }, 100);
        }

        // モーダル閉じる
        function closeWorkModal() {
            const modal = document.getElementById('workModal');
            modal.classList.remove('active');
            document.body.style.overflow = 'auto';
            
            if (animationId) {
                cancelAnimationFrame(animationId);
                animationId = null;
            }
            
            if (threeJSInstance && threeJSInstance.renderer) {
                threeJSInstance.renderer.domElement.remove();
                threeJSInstance.renderer.dispose();
                threeJSInstance = null;
            }
            
            document.getElementById('workCanvas').style.display = 'block';
            currentArtwork = null;
        }

        // コードコピー機能
        function copyCode(artworkId) {
            const artwork = artworks.find(a => a.id === artworkId);
            if (!artwork) return;

            navigator.clipboard.writeText(artwork.codeString).then(() => {
                const btn = event.target;
                const originalText = btn.textContent;
                btn.textContent = '✅';
                btn.classList.add('copied');
                
                setTimeout(() => {
                    btn.textContent = originalText;
                    btn.classList.remove('copied');
                }, 2000);
            }).catch(err => {
                console.error('コピーに失敗:', err);
                alert('コピーに失敗しました');
            });
        }

        // 開発者モード
        function toggleDevMode() {
            const devMode = document.getElementById('devMode');
            devMode.classList.toggle('active');
        }

        // 新作品追加/編集
        function addNewWork(event) {
            event.preventDefault();
            
            const title = document.getElementById('newTitle').value;
            const description = document.getElementById('newDescription').value;
            const tech = document.getElementById('newTech').value.split(',').map(t => t.trim());
            const type = document.getElementById('newType').value;
            const codeString = document.getElementById('newCode').value;

            try {
                let newArtwork;
                
                if (type === 'canvas') {
                    const drawFunction = new Function('ctx', 'canvas', codeString);
                    newArtwork = {
                        id: editingArtworkId || 'custom-' + Date.now(),
                        title: title,
                        description: description,
                        tech: tech,
                        category: 'custom',
                        type: 'canvas',
                        codeString: codeString,
                        drawFunction: drawFunction
                    };
                } else if (type === 'threejs') {
                    const initFunction = new Function('container', codeString);
                    newArtwork = {
                        id: editingArtworkId || 'custom-' + Date.now(),
                        title: title,
                        description: description,
                        tech: tech,
                        category: 'custom',
                        type: 'threejs',
                        codeString: codeString,
                        initFunction: initFunction
                    };
                }

                if (editingArtworkId) {
                    const index = artworks.findIndex(a => a.id === editingArtworkId);
                    if (index !== -1) {
                        artworks[index] = newArtwork;
                        alert('作品を更新しました！');
                    }
                    editingArtworkId = null;
                } else {
                    artworks.push(newArtwork);
                    alert('新作品を追加しました！');
                }

                generateWorkCards();
                updateArtworkList();
                
                document.getElementById('newTitle').value = '';
                document.getElementById('newDescription').value = '';
                document.getElementById('newTech').value = '';
                document.getElementById('newType').value = '';
                document.getElementById('newCode').value = '';
                
                const submitBtn = document.querySelector('#addPanel button[type="submit"]');
                submitBtn.textContent = '作品を追加';
                submitBtn.style.background = 'var(--zen-accent)';
                
                toggleDevMode();
                
            } catch (error) {
                alert('コードエラー: ' + error.message);
            }
        }

        // Three.js背景（テーマ対応）
        function initBackground() {
            const canvas = document.getElementById('zen-canvas');
            const scene = new THREE.Scene();
            const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            const renderer = new THREE.WebGLRenderer({ canvas: canvas, alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);

            const geometry = new THREE.BufferGeometry();
            const particleCount = 100;
            const positions = new Float32Array(particleCount * 3);

            for (let i = 0; i < particleCount * 3; i += 3) {
                positions[i] = (Math.random() - 0.5) * 20;
                positions[i + 1] = (Math.random() - 0.5) * 20;
                positions[i + 2] = (Math.random() - 0.5) * 20;
            }

            geometry.setAttribute('position', new THREE.BufferAttribute(positions, 3));

            const material = new THREE.PointsMaterial({
                color: 0xd4af37,
                size: 0.02,
                transparent: true,
                opacity: 0.6
            });

            const particles = new THREE.Points(geometry, material);
            scene.add(particles);
            camera.position.z = 10;

            function animate() {
                requestAnimationFrame(animate);
                particles.rotation.y += 0.001;
                renderer.render(scene, camera);
            }
            animate();

            window.addEventListener('resize', () => {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            });

            // テーマ更新関数
            backgroundInstance = {
                updateTheme: function() {
                    const isWashi = document.documentElement.dataset.theme === 'washi';
                    material.color.setHex(isWashi ? 0x8b4513 : 0xd4af37);
                }
            };
        }

        // ESCキーでモーダル閉じる
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && currentArtwork) {
                closeWorkModal();
            }
        });

        // 初期化
        document.addEventListener('DOMContentLoaded', () => {
            hideLoading();
            initBackground();
            generateWorkCards();
            
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('visible');
                    }
                });
            }, { threshold: 0.2 });

            document.querySelectorAll('.section-title').forEach(el => {
                observer.observe(el);
            });
        });
    </script>
</body>
</html>
